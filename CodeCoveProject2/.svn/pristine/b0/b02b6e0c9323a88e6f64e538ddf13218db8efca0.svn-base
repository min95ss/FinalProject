<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://www.springframework.org/tags/form" prefix="form" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style type="text/css">
#writeModal {
	position: fixed;
	height: 100%;
    width: 100%;
    left: 0;
    top: 0;
    background-color: rgba(0,0,0,0.5);
    display: none;
}

#writeCont{
	width:60%;
	height: 80%;
	margin-top:10%;
	margin-left: 20% ;
	margin-right: 20% ;
	background-color: white;
	color: black;
}

.form_radio_btn {
	width: 47%;
	height : 45px;
	border: 1px solid #EAE7E7;
	border-radius: 10px;
}
.form_radio_btn input[type=radio] {
	display: none;
}
.form_radio_btn label {
	display: block;
	border-radius: 10px;
	margin: 0 auto;
	text-align: center;
	height: -webkit-fill-available;
	line-height: 45px;
}
 
/* Checked */
.form_radio_btn input[type=radio]:checked + label {
	background: #581CFF;
	color: #fff;
}
 
/* Hover */
.form_radio_btn label:hover {
	color: #666;
}
 
/* Disabled */
.form_radio_btn input[type=radio] + label {
	background: #F9FAFC;
	color: #666;
}
#tagInput {
	font-size: 15px;
	height: 30px;
	padding: 15px;
 	width: 25%; 
 	float:left;
}
.tags {
	background-color: #F2F2F2;
	color: black;
	margin-left: 3px;
	margin-top: 3px;
	border: 5px solid #F2F2F2;
	font-weight: 500;
	border-radius: 10px;
	display: inline-block;
}
</style>
</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
<body>
<script type="text/javascript">
$(function() {
    $('#DateS').daterangepicker({
		locale: {
			format: 'YYYY-MM-DD'
		},
		singleDatePicker: true,
		showDropdowns: true,
		minYear: 1901,
		maxYear: parseInt(moment().format('YYYY'),10)
    });
  });
  
$(function() {
    $('#DateE').daterangepicker({
		locale: {
			format: 'YYYY-MM-DD'
		},
		singleDatePicker: true,
		showDropdowns: true,
		minYear: 1901,
		maxYear: parseInt(moment().format('YYYY'),10)
    });
  });
  
document.addEventListener('keydown', function(event) {
  if (event.keyCode === 13) {
    event.preventDefault();
  };
}, true);
</script>
<!--//Page Toolbar//-->
<div class="toolbar px-3 px-lg-6 pt-3 pb-3">
  <div class="position-relative container-fluid px-0">
    <div class="row align-items-center position-relative">
      <div class="col-sm-7 mb-3 mb-sm-0">
         <!-- Dropdown -->
         <c:if test="${loginId == project.pjAdminId }">
         <div class="dropdown" style="float:left;">
           <a href="#" class="btn p-0 text-body border-0 shadow-none size-35 d-flex align-items-center justify-content-center rounded-pill" role="button" data-bs-toggle="dropdown"
             aria-haspopup="true" aria-expanded="false">
             <span class="material-symbols-rounded align-middle">
               more_vert
               </span>
           </a>
           <div class="dropdown-menu mt-1 dropdown-menu-end">
             <a href="/coco/project/modify?pjId=${project.pjId }" class="dropdown-item">
               프로젝트 수정
             </a>
             	<form action="/coco/project/delete" method="post">
					<input type="hidden" name="pjId" value="${project.pjId}">
             		<button type="submit" class="dropdown-item" 
             		onclick="return confirm('삭제하시겠습니까?')">프로젝트 삭제</button>
					</form>
           </div>
         </div>
         </c:if>
        <h3 class="mb-2"><span>${project.pjName }</span></h3>
        <p class="mb-0">${project.pjObjTitle}</p>
      </div>
      	<input type="hidden" id="projectStart" value="${project.pjStartDate }">
      	<input type="hidden" id="projectEnd" value="${project.pjEndDate }">
      <div class="col-sm-5 text-md-end">
        <div class="d-flex justify-content-sm-end align-items-center">
          <div class="d-flex align-items-center">
            <div role="button" id="reportrange" class="btn btn-sm btn-outline-secondary" data-tippy-placement="left"
              data-tippy-content="프로젝트 기간">
              <i class="material-symbols-rounded align-middle fs-5">
                calendar_month
              </i>
              <span class="fs-6 d-inline-block"></span>
            </div>
          </div>
<!--           <a href="#!" data-tippy-placement="left" data-tippy-content="Reload Dashboard" -->
<!--             class="flex-shrink-0 ms-2 p-0 rounded-circle size-35 d-flex align-items-center justify-content-center btn btn-primary"> -->
<!--             <span class="material-symbols-rounded lh-1 fs-4"> -->
<!--               refresh -->
<!--             </span> -->
<!--           </a> -->
        </div>
      </div>
    </div>
  </div>
</div>
<!--//Page Toolbar End//-->
<div class="content d-flex flex-column-fluid">
	<div class="container-fluid px-0">
	    <!--Profile-->
	    <div class="pt-3 px-3 px-lg-6 overflow-hidden">

			<!--Profile content-->
                                <div class="pt-md-3">

                                    <!--Profile Nav Tabs-->
                                    <ul class="nav mb-3 nav-tabs nav-overflow">
                                        <li class="nav-item">
                                            <a href="#!profile-feed.html" class="nav-link active">
                                                홈
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a href="#!profile-friends.html" class="nav-link">
                                                업무
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a href="#!profile-projects.html" class="nav-link">
                                                간트차트
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a href="#!profile-photos.html" class="nav-link">
                                                칸반보드
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a href="#!profile-followers.html" class="nav-link">
                                                캘린더
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a href="#!profile-followers.html" class="nav-link">
                                                워크시트
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a href="#!profile-followers.html" class="nav-link">
                                                자료실
                                            </a>
                                        </li>
                                    </ul>

                                    <!--Content-->
                                    <div class="row">
                                        <div class="col-lg-4">
                                        
                                         <div class="card overflow-hidden" style="margin-bottom:20px;">
                                            <!--Modal example-->
                                            <!-- Button trigger modal -->
                                            <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                                                data-bs-target="#inviteModal">
                                                <span class="material-symbols-rounded align-middle" style="margin-left:-20px; margin-right:10px;" >Person_Add</span>초대하기
                                            </button>
                                            
                                            <input type="hidden" id="invitePjName" name="invitePjName" value="${project.pjName }">
                                            <div class="modal fade" id="inviteModal" tabindex="-1"
                                                aria-labelledby="inviteModal" aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-centered">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="inviteModalLabel">이메일 초대장 발송</h5>
                                                            <button type="button" class="btn-close"
                                                                data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <div class="col-12 col-md-12 mb-3" style="text-align: center">
														        <div class="form-group">
														            <input type="text" class="form-control" id="inviteMail" name="inviteMail" placeholder="example@coco.team" required="required"/>
														        </div>
														    </div>
														    <div class="col-12 col-md-12 mb-3">
														        <div class="form-group">
														        	<h6>초대내용 입력</h6>
														            <textarea class="form-control" id="inviteContent" name="inviteContent" style="height:200px;"></textarea>
														        </div>
														    </div>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary"
                                                                data-bs-dismiss="modal">취소</button>
                                                            <button type="button" id="inviteBtn" class="btn btn-primary">초대</button>
                                                        </div>
                                                    </div>
                                            </div>
                                            </div>
                                            
                                            </div>
                                        
                                        <h5>참여자 ${colleagueList.size() }</h5>

                                            <!--Card-->
                                            <div class="card mb-3 mb-lg-5">
                                                <div class="d-flex p-3 pb-0 align-items-center jsutify-content-between">
                                                    <h5 class="mb-0 me-1">프로젝트 매니저</h5>
                                                </div>
                                                <!--Card body-->
                                                <div class="card-body">
                                                    <ul class="list-group list-group-flush">

                                                        <!--User List item-->
                                                        <c:forEach items="${colleagueList }" var="coll" >
                                                        <c:if test="${coll.memId == project.pjAdminId }">
                                                        <li class="list-group-item">
                                                            <div class="row g-2 align-items-center">
                                                                <div class="col-auto">
                                                                    <div
                                                                        class="avatar-status status-offline me-2 avatar sm">
                                                                        <img src="${coll.memProfile }"
                                                                            class="rounded-circle img-fluid" alt="">
                                                                    </div>
                                                                </div>
                                                                <div class="col">
                                                                    <h6 class="mb-0">${coll.memNick}</h6>
                                                                    <small>${coll.memMail }</small>
                                                                </div>
                                                                <div class="col-auto">
                                                                    <div class="dropdown">
                                                                        <a href="#" class="btn p-1 btn-outline-secondary"
                                                                            data-bs-toggle="dropdown">
                                                                            <span
                                                                                class="material-symbols-rounded align-middle">
                                                                                more_vert
                                                                            </span>
                                                                        </a>
                                                                        <div
                                                                            class="dropdown-menu dropdown-menu-end">
                                                                            <a href="#!" class="dropdown-item">
                                                                                <small>Follow</small>
                                                                            </a>
                                                                            <a href="#!" class="dropdown-item">
                                                                                <small>Hide this user</small>
                                                                            </a>
                                                                            <a href="#!" class="dropdown-item">
                                                                                <small>Block this user</small>
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </li>
                                                        </c:if>
                                                         </c:forEach>
                                                        </ul>
                                                        
                                                        <div class="d-flex p-3 pb-0 align-items-center jsutify-content-between">
                                                    <h5 class="mb-0 me-1">팀원</h5>
                                                </div>
                                                <!--Card body-->
                                                    <ul class="list-group list-group-flush">
                                                        <!--User List item-->
                                                        <c:forEach items="${colleagueList }" var="coll">
                                                        <c:choose>
	                                                        <c:when test="${coll.memId == project.pjAdminId }">
	                                                        </c:when>
	                                                        <c:otherwise>
	                                                        	<li class="list-group-item">
                                                            <div class="row g-2 align-items-center">
                                                                <div class="col-auto">
                                                                    <div
                                                                        class="avatar-status status-offline me-2 avatar sm">
                                                                        <img src="${coll.colProfile }"
                                                                            class="rounded-circle img-fluid" alt="">
                                                                    </div>
                                                                </div>
                                                                <div class="col">
                                                                    <h6 class="mb-0">${coll.memNick }</h6>
                                                                    <small>${coll.memMail }</small>
                                                                </div>
                                                                <div class="col-auto">
                                                                    <div class="dropdown">
                                                                        <a href="#" class="btn p-1 btn-outline-secondary"
                                                                            data-bs-toggle="dropdown">
                                                                            <span
                                                                                class="material-symbols-rounded align-middle">
                                                                                more_vert
                                                                            </span>
                                                                        </a>
                                                                        <div
                                                                            class="dropdown-menu dropdown-menu-end">
                                                                            <a href="#!" class="dropdown-item">
                                                                                <small>Follow</small>
                                                                            </a>
                                                                            <a href="#!" class="dropdown-item">
                                                                                <small>Hide this user</small>
                                                                            </a>
                                                                            <a href="#!" class="dropdown-item">
                                                                                <small>Block this user</small>
                                                                            </a>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </li>
	                                                        </c:otherwise>
                                                        </c:choose>
                                                        
                                                        </c:forEach>
                                                        
                                                    </ul>
                                                    
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-8">
                                        
                                        <!-- 모달  -->
                                    <div class="card overflow-hidden">
                                        <div class="card-header">
                                            <h5 class="mb-0">Basic Modal</h5>
                                        </div>
                                        <div class="card-body">
                                            <!--Modal example-->
                                            <!-- Button trigger modal -->
                                            <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                                                data-bs-target="#exampleModal">
                                                업무 등록
                                            </button>


                                            <!-- Modal -->
                                            <form action="/coco/work/register/${project.pjId }" method="post">
                                            
<%--                                             <input type="hidden" name="pjId" value="${project.pjId }"/> --%>
                                            
                                            <div class="modal fade" id="exampleModal" tabindex="-1"
                                                aria-labelledby="exampleModalLabel" aria-hidden="true">
                                                <div class="modal-dialog">
                                                    <div class="modal-content" style="width: 130%;">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title" id="exampleModalLabel">업무 작성
                                                            </h5>
                                                            <button type="button" class="btn-close"
                                                                data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            <div class="col-12 col-md-12 mb-3" style="text-align: center">
														        <div class="form-group">
														            <input type="text" class="form-control" id="workTitle" name="workTitle" placeholder="제목을 입력해주세요" required="required"/>
														        </div>
														    </div>
                                                            <div class="col-12 col-md-12 mb-3">
														        <div class="form-group">
																	<div class="form_toggle row-vh d-flex flex-row justify-content-between" >
														        	<span class="material-symbols-rounded" style="margin-right: 10px; margin-top:10px;">update</span>
																		<div class="form_radio_btn radio_male">
																			<input id="radio-1" class="workStatusCode" type="radio" name="workStatusCode" value="WKST01">
																			<label for="radio-1">요청</label>
																		</div>
																									 
																		<div class="form_radio_btn">
																			<input id="radio-2" class="workStatusCode" type="radio" name="workStatusCode" value="WKST02">
																			<label for="radio-2">진행</label>
																		</div>

																		<div class="form_radio_btn">
																			<input id="radio-3" class="workStatusCode" type="radio" name="workStatusCode" value="WKST03">
																			<label for="radio-3">피드백</label>
																		</div>

																		<div class="form_radio_btn">
																			<input id="radio-4" class="workStatusCode" type="radio" name="workStatusCode" value="WKST04">
																			<label for="radio-4">완료</label>
																		</div>

																		<div class="form_radio_btn">
																			<input id="radio-5" class="workStatusCode" type="radio" name="workStatusCode" value="WKST05">
																			<label for="radio-5">보류</label>
																		</div>
																	</div>
																</div>
														    </div>
														    
														    <div class="col-12 col-md-12 mb-3">
														        <div class="form-group">
														            <span class="material-symbols-rounded" style="margin-right:10px; margin-top:5px; float:left">account_circle</span>
<!-- 														            	<div id="tagArea" style="float:left;"></div> -->
<!-- 																		<input type="text" name="assignMemId" id="tagInput" class="form-control" placeholder="담당자 추가"> -->
															            <div style="float:left; width:90%;">
<!-- 																	    	<input type="text" id="assignMemId" name="assignMemId" class="form-control" placeholder="담당자 추가" data-choices='{"silent": true,"removeItems": "true","removeItemButton": "true", "itemSelectText":""}'> -->
																	    	<select id="assignMemId" name="assignMemId" multiple class="form-control" data-choices='{"silent": true,"removeItems": "true","removeItemButton": "true", "itemSelectText":""}'>
																	    		<c:forEach items="${colleagueList }" var="workAssign">
													                           		<option value="${workAssign.colNum }">${workAssign.memNick }</option>
												                           		</c:forEach>
																	    	</select>
															            </div>
														        </div>
														    </div>
														    <br>
														    <br>

														    <div class="col-12 col-md-4 mb-3">
														        <div class="form-group" style="margin-top:20px;">
														            <span class="material-symbols-rounded" style="margin-right:10px; margin-top:5px; float:left;">calendar_today</span>
														            <input class="form-control" id="DateS" name="workStartDate" placeholder="시작일 추가" type="text" style="width:80%;">
														        </div>
														    </div>
														    <div class="col-12 col-md-4 mb-3">
														        <div class="form-group">
														            <span class="material-symbols-rounded" style="margin-right:10px; margin-top:5px; float:left;">calendar_today</span>
														            <input class="form-control" id="DateE" name="workEndDate" placeholder="마감일 추가" type="text" style="width:80%;">
														        </div>
														    </div>
														    
														    <div class="col-12 col-md-4 mb-3">
														        <div class="form-group">
														            <span class="material-symbols-rounded" style="margin-right:10px; margin-top:10px; float:left;">Flag</span>
														            <div style="float:left; width:80%;">
												                       <select id="chBasic" class="form-control" name="workPriority"
												                           data-choices='{"searchEnabled":false, "itemSelectText":""}'>
												                           <c:forEach items="${priCode }" var="priCode">
													                           <option value="${priCode.comCode }">${priCode.comCodeNm }</option>
												                           </c:forEach>
												                       </select>
														            </div>
														        </div>
														    </div>
														    
														    <div class="col-12 col-md-12 mb-3">
														        <div class="form-group">
														            <textarea class="form-control" id="workContent" name="workContent" style="height:200px; margin-top:85px;"></textarea>
<!-- 														            <textarea class="form-control" id="workContent" name="workContent"></textarea> -->
														        </div>
														    </div>
														    
														    
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="submit" class="btn btn-primary">등록</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                    </form>
                                            
                                        </div>
                                    </div>
                                    <!-- 모달 -->
                                    <hr>

									<c:choose>
										<c:when test="${empty workList }">
												등록된 업무가 존재하지 않습니다.
										</c:when>
										<c:otherwise>
											<c:forEach items="${workList }" var="work">
											<script type="text/javascript">
											$(function() {
											    $('#workDateS${work.workNum }').daterangepicker({
													locale: {
														format: 'YYYY-MM-DD'
													},
													singleDatePicker: true,
													showDropdowns: true,
													minYear: 1901,
													maxYear: parseInt(moment().format('YYYY'),10)
											    });
											  });
											  
											$(function() {
											    $('#workDateE${work.workNum }').daterangepicker({
													locale: {
														format: 'YYYY-MM-DD'
													},
													singleDatePicker: true,
													showDropdowns: true,
													minYear: 1901,
													maxYear: parseInt(moment().format('YYYY'),10)
											    });
											  });
											  
											$(document).ready(function() {
												  $('#workProgress${work.workNum}').on('input', function() {
												    var progressValue = $(this).val();
												    $('#progress-value${work.workNum}').text(progressValue + '%');
												  });

												  $('#workProgress${work.workNum}').on('change', function() {
												    var progressValue = $(this).val();
												    var newProgressValue = Math.round(progressValue / 10) * 10;
												    $(this).val(newProgressValue);
												    $('#progress-value${work.workNum}').text(newProgressValue + '%');
												    console.log("퍼센트" + newProgressValue);
												  });
												});
											
											</script>
											
                                            <!--Post card start-->
                                            <c:forEach items="${colleagueList }" var="coll" >
                                            <c:if test="${coll.memId == work.workReq }">
                                            
                                            <div class="card mb-3 mb-lg-5">
                                                <div class="card-body">
                                                    <div class="d-flex justify-content-start align-items-center mb-3">
                                                        <span
                                                            class="avatar flex-shrink-0 rounded-circle d-inline-block">
                                                            <img src="${coll.memProfile }" alt="avatar"
                                                                class="img-fluid rounded-circle">
                                                        
                                                        </span>
                                                        <div class="ps-3" style="margin-right: auto;">
                                                            <h6 class="mb-0">${coll.memNick }</h6>
                                                            <small class="text-body-subtle">${work.workCreateDate }</small>
                                                        </div>
                                                        
                                                        <c:if test="${loginId == work.workReq }">
												         <div class="dropdown" class="ps-3" style="float:left;">
												           <a href="#" class="btn p-0 text-body border-0 shadow-none size-35 d-flex align-items-center justify-content-center rounded-pill" role="button" data-bs-toggle="dropdown"
												             aria-haspopup="true" aria-expanded="false">
												             <span class="material-symbols-rounded align-middle">
												               more_vert
												               </span>
												           </a>
												           <div class="dropdown-menu mt-1 dropdown-menu-end">
												             <a href="#" class="dropdown-item">
												               업무 수정
												             </a>
												             	<form action="/coco/work/delete" method="post">
																	<input type="hidden" name="pjId" value="${project.pjId}">
																	<input type="hidden" name="workNum" value="${work.workNum}">
												             		<button type="submit" class="dropdown-item" 
												             		onclick="return confirm('삭제하시겠습니까?')">업무 삭제</button>
																	</form>
												           </div>
												         </div>
												         </c:if>
                                                        
                                                    </div>
                                                    <br>
                                                    <p>${work.workTitle }</p>
<!--                                                     <img src="assets/media/900x600/5.jpg" -->
<!--                                                         class="img-fluid mb-3 rounded-3 shadow" alt=""> -->
                                                    <hr style="border: 1px solid gray">
                                                    
                                                    <div class="col-12 col-md-12 mb-3">
                                                    
                                                    <input type="hidden" name="workStatusCode" value="WS01" />
                                                    
												        <div class="form-group">
															<div class="form_toggle row-vh d-flex flex-row justify-content-between" >
												        	<span class="material-symbols-rounded" style="margin-right: 10px; margin-top:10px;">update</span>
																<div class="form_radio_btn radio">
																	<input id="radio-d1${work.workNum }" class="" type="radio" name="workStatusCode${work.workNum }" value="WKST01" <c:if test="${work.workStatusCode eq 'WKST01' }">checked</c:if>>
																	<label for="radio-d1${work.workNum }">요청</label>
																</div>
																							 
																<div class="form_radio_btn">
																	<input id="radio-d2${work.workNum }" class="" type="radio" name="workStatusCode${work.workNum }" value="WKST02" <c:if test="${work.workStatusCode eq 'WKST02' }">checked</c:if>>
																	<label for="radio-d2${work.workNum }">진행</label>
																</div>
	
																<div class="form_radio_btn">
																	<input id="radio-d3${work.workNum }" class="" type="radio" name="workStatusCode${work.workNum }" value="WKST03" <c:if test="${work.workStatusCode eq 'WKST03' }">checked</c:if>>
																	<label for="radio-d3${work.workNum }">피드백</label>
																</div>
	
																<div class="form_radio_btn">
																	<input id="radio-d4${work.workNum }" class="" type="radio" name="workStatusCode${work.workNum }" value="WKST04" <c:if test="${work.workStatusCode eq 'WKST04' }">checked</c:if>>
																	<label for="radio-d4${work.workNum }">완료</label>
																</div>
	
																<div class="form_radio_btn">
																	<input id="radio-d5${work.workNum }" class="" type="radio" name="workStatusCode${work.workNum }" value="WKST05" <c:if test="${work.workStatusCode eq 'WKST05' }">checked</c:if>>
																	<label for="radio-d5${work.workNum }">보류</label>
																</div>
															</div>
														</div>
												    </div>
                                                    <div class="col-12 col-md-12 mb-3">
												        <div class="form-group">
												            <span class="material-symbols-rounded" style="margin-right:10px; margin-top:10px; float:left">account_circle</span>
												            <div style="float:left; width:90%;">
														    	<input type="text" class="form-control" placeholder="담당자 추가" value="${work.assignMemId }" data-choices='{"silent": true,"removeItems": "true","removeItemButton": "", "itemSelectText":""}'>
												            </div>
												        </div>
												    </div>
												    <br>
												    <br>
												    <br>
												    
												    <div class="col-12 col-md-4 mb-3">
												        <div class="form-group">
												            <span class="material-symbols-rounded" style="margin-right:10px; margin-top:5px; float:left;">calendar_today</span>
												            <input class="form-control" id="workDateS${work.workNum }" name="workStartDate" value="${work.workStartDate }" type="text" style="width:80%;">
												        </div>
												    </div>
												    <div class="col-12 col-md-4 mb-3">
												        <div class="form-group">
												            <span class="material-symbols-rounded" style="margin-right:10px; margin-top:5px; float:left;">calendar_today</span>
												            <input class="form-control" id="workDateE${work.workNum }" name="workEndDate" value="${work.workEndDate }" type="text" style="width:80%;">
												        </div>
												    </div>
												    
												    <div class="col-12 col-md-4 mb-3">
												        <div class="form-group">
												            <span class="material-symbols-rounded" style="margin-right:10px; margin-top:10px; float:left;">Flag</span>
												            <div style="float:left; width:80%;">
												            	<select id="chBasic" class="form-control" name="workPriority"
						                                            data-choices='{"searchEnabled":false, "itemSelectText":"" }'>
<%-- 						                                            <option value="WP01" <c:if test="${work.workPriority eq 'WP01' }">selected</c:if>>낮음</option> --%>
						                                            <c:forEach items="${priCode }" var="priCode">
											                           <option value="${priCode.comCode }" <c:if test="${work.workPriority eq priCode.comCode }">selected</c:if>>${priCode.comCodeNm }</option>
										                           </c:forEach>
						                                        </select>
												            </div>
												        </div>
												    </div>
												    
												    <br>
												    <br>
												    <br>
												    
												    <div class="col-12 col-md-6 mb-3">
												        <div class="form-group">
												            <span class="material-symbols-rounded" style="margin-right:10px; float:left;">calendar_today</span>
														    <input type="range" class="form-range" min="0" max="100" step="10" style="width:50%; float:left; margin-right:15px;"
										                    	id="workProgress${work.workNum}" name="workProgress" value="${work.workProgress }">
										                    <span id="progress-value${work.workNum}">${work.workProgress }%</span>
												        </div>
												    </div>
												    
												     <br>
								                    
								                    <p>${work.workContent }</p>
												    
												    
										<!--Reaction list-->

                                                     <!--Likes-->
                                                     <div
                                                     class="d-flex pb-3 mb-3 border-bottom align-items-center small">

                                                     <!--Comments-->
                                                     <a href="#!"
                                                         class="d-flex align-items-center ms-auto">
                                                         <span
                                                             class="fs-5 align-middle me-2 material-symbols-rounded">
                                                             comment
                                                         </span>
                                                         <span>${work.issueList.size()}</span>
                                                     </a>
                                                 </div>

                                                    <!--Comments list-->
                                                    <ul class="list-group" id="comment-list${work.workNum }">
			                                            <c:forEach items="${work.issueList }" var="issue">
			                                            
                                                        <c:forEach items="${colleagueList }" var="collIssue">
                                                        <c:if test="${issue.issueReq == collIssue.memId }">
                                                        <li class="list-group-item" id="issueSelectDel${issue.issueNum }">
                                                            <div class="d-flex align-items-stretch" style="float:left;">
                                                                <a href="#!" class="flex-shrink-0 d-block me-2">
                                                                    <img src="${collIssue.memProfile }"
                                                                        class="avatar sm rounded-circle" alt="">
                                                                
                                                                </a>
                                                                <!--Coomments and replies-->
                                                                <div>
<!--                                                                     <div class="py-2 mb-1 px-3 bg-body rounded-3"> -->
                                                                    <div class="py-2 mb-1 px-3 rounded-3">
<!--                                                                         <div class="d-flex justify-content-between"> -->
                                                                        <div class="d-flex">
                                                                            <h6 class="mb-0">${collIssue.memNick }</h6>
                                                                            <small class="text-body-secondary" style="margin-left:10px;">${issue.issueDate }</small>
                                                                        </div>
                                                                        <p class="mb-0">${issue.issueContent }</p>
                                                                    </div>
<!--                                                                     Reply link -->
<!--                                                                     <div class="mb-2 small"> -->
<!--                                                                         <a href="#!" class="text-reset">Reply</a> -->
<!--                                                                     </div> -->
<!--                                                                     Reply -->
<!--                                                                     <div class="d-flex align-items-stretch"> -->
<!--                                                                         <a href="#!" class="flex-shrink-0 d-block me-2"> -->
<!--                                                                             <img src="assets/media/avatars/02.jpg" -->
<!--                                                                                 class="avatar xs rounded-circle" alt=""> -->
<!--                                                                         </a> -->
<!--                                                                         Reply -->
<!--                                                                         <div> -->
<!--                                                                             <div -->
<!--                                                                                 class="py-2 mb-1 px-3 bg-body rounded-3"> -->
<!--                                                                                 <div -->
<!--                                                                                     class="d-flex justify-content-between"> -->
<!--                                                                                     <h6 class="mb-0">Milana Myles</h6> -->
<!--                                                                                     <small class="text-body-secondary">12:43 -->
<!--                                                                                         PM</small> -->
<!--                                                                                 </div> -->
<!--                                                                                 <p class="mb-0"> -->
<!--                                                                                     Lorem ipsum, or lipsum as it is -->
<!--                                                                                     sometimes known. -->
<!--                                                                                 </p> -->
<!--                                                                             </div> -->
<!--                                                                             Reply link -->
<!--                                                                             <div class="mb-0 small"> -->
<!--                                                                                 <a href="#!" -->
<!--                                                                                     class="text-reset">Reply</a> -->
<!--                                                                             </div> -->
<!--                                                                         </div> -->

<!--                                                                     </div> -->
                                                                </div>
                                                            </div>
                                                             <div>
<!--                                                              	<button type="button" class="btn btn-outline-danger" style="float: right;">삭제</button> -->
																<c:choose>
																<c:when test="${loginId == issue.issueReq }">
                                                              		<button type="button" id="issueDel${issue.issueNum }" class="badge bg-danger-subtle text-danger" style="float: right; border:0px;">삭제</button>
																</c:when>
																<c:when test="${loginId == project.pjAdminId }">
                                                              		<button type="button" id="issueDel${issue.issueNum }" class="badge bg-danger-subtle text-danger" style="float: right; border:0px;">삭제</button>
																</c:when>
																<c:otherwise></c:otherwise>
																</c:choose>
                                                             </div>
                                                        </li>
                                                        <input type="hidden" id="issueNum${issue.issueNum }" name="issueNum" value="${issue.issueNum }" >

                                                        <script type="text/javascript">
                                                        	$(function(){
		                                                        var issueDel = $("#issueDel${issue.issueNum }");
		    													var issueNum = document.getElementById('issueNum${issue.issueNum }');
		    													
		    													issueDel.on("click",function(){
		    														if(confirm("정말로 삭제하시겠습니까?")){
			    														console.log(issueNum.value);
			    														$.ajax({
			    															type : "post",
			    															url : "/coco/issue/delete",
			    															data : {
			    																issueNum : issueNum.value
			    															},
			    															success : function(result){
			    																$('#issueSelectDel${issue.issueNum }').remove();
			    															}
			    														});
	                                                        		}
		    													});
		    													
                                                        	});
														</script>

														</c:if>
														<!-- issueList 안에 collList 끝 -->
                                                        </c:forEach>
                                                        
                                                        <!-- issueList끝 -->
                                                        </c:forEach>
                                                        </ul>
                                                        
                                                        <ul class="list-group">
                                                        <li class="list-group-item bg-body">
                                                            <!--Add comment-->
                                                            <h6>Comment</h6>
<%--                                                             <form action="#!"> --%>
                                                                <textarea id="issueContent${work.workNum }" name="issueContent" rows="2"
                                                                    class="form-control mb-2"></textarea>
                                                                <div class="text-end">
                                                                    <button type="button" class="btn btn-primary btn-sm" id="issueBtn${work.workNum }">
                                                                        작성</button>
                                                                </div>
<%--                                                             </form> --%>
                                                        </li>
                                                    </ul>
												
												<c:forEach items="${colleagueList }" var="collIssue">
												<c:if test="${loginId == collIssue.memId }">
												<input type="hidden" id="memProfile${coll.colNum }" name="" value="${collIssue.memProfile }" >
												<input type="hidden" id="memName${coll.colNum }" name="" value="${collIssue.memNick }" >
												</c:if>
												</c:forEach>

                                                </div>
                                            </div>
                                            
                                            <input type="hidden" id="workNum${work.workNum }" name="workNum" value="${work.workNum }" >
                                            <!--/.Post card end-->
                                            <script type="text/javascript">
												$(function(){
													var issueBtn = $("#issueBtn${work.workNum }");
													var issueContent = document.getElementById('issueContent${work.workNum }');
													var workNum = document.getElementById('workNum${work.workNum }');
													var memProfile = $("#memProfile${coll.colNum }")
													var memName = $("#memName${coll.colNum }")
													
// 													var insertIssueDelBtn = null;
// 													var insertIssueNum = null;
													
													issueBtn.on("click", function(){
														console.log(issueContent.value);
														console.log(workNum.value);
														console.log(memProfile.val());
														console.log(memName.val());
														$.ajax({
															type : "post",
															url : "/coco/issue/register",
															data : {
																issueContent : issueContent.value,
																workNum : workNum.value
															},
															success : function(result){
																var insertIssueNum = result.issueNum;
																var newItem = '<li class="list-group-item" id="insertIssueSelectDel'+ insertIssueNum +'">';
																newItem += '<div class="d-flex align-items-stretch" style="float:left;">';
																newItem += '<div class="d-flex align-items-stretch">';
																newItem += '<a href="#!" class="flex-shrink-0 d-block me-2">'; 
																newItem += '<img src="'+memProfile.val()+'" class="avatar sm rounded-circle" alt="">';  
													            newItem += '</a>';
													            newItem += '<div>';
													            newItem += '<div class="py-2 mb-1 px-3 rounded-3">';
													            newItem += '<div class="d-flex">';
													            newItem += '<h6 class="mb-0">'+ memName.val() +'</h6>';
													            newItem += '<small class="text-body-secondary" style="margin-left:10px;">'+result.issueDate +'</small>';
													            newItem += '</div>';
													            newItem += '<p class="mb-0">' + issueContent.value + '</p>';
													            newItem += '</div>';
													            newItem += '</div>';
													            newItem += '</div>';
													            newItem += '</div>';
													            newItem += '<button type="button" id="issueDel' + result.issueNum + '" class="badge bg-danger-subtle text-danger" style="float: right; border:0px;">삭제</button>';
													            newItem += '</div>';
													            newItem += '</li>';
													            
													            $('#comment-list${work.workNum }').append(newItem);
													            
													            issueContent.value = '';
													            
													            var insertIssueDelBtn = $("#issueDel" + result.issueNum);
													            
													            insertIssueDelBtn.on("click",function(){
														            console.log(insertIssueDelBtn);
														            console.log(insertIssueNum);
																	if(confirm("정말로 삭제하시겠습니까?")){
			    														$.ajax({
			    															type : "post",
			    															url : "/coco/issue/delete",
			    															data : {
			    																issueNum : insertIssueNum
			    															},
			    															success : function(result){
			    																$('#insertIssueSelectDel'+insertIssueNum).remove();
			    															}
			    														});
			                                                		}
																});
													            
															}
														});
													});
													
												});
											</script>
											<!-- colleagueList 포문 끝 -->
                                            </c:if>
                                            </c:forEach>
                                            
                                            <!-- workList 포문 끝 -->
                                            </c:forEach>
										</c:otherwise>
									</c:choose>
                                            
                            </div>
                            </div>
                            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
function attaDelBtn(el){
	el.css("display", "none");
	el.prev().css("display", "none");
	let attatchNum = el.data("attnum");
	let attatchOrder = el.data("attorder");
	
	let delNum = $("<input>").attr("name", "delAttatchNum").attr("type", "hidden").val(attatchNum);
	let delOrder = $("<input>").attr("name", "delAttatchOrder").attr("type", "hidden").val(attatchOrder);
	
	$("#postForm").append(delNum, delOrder);
}
  
   let arrTag = new Array();
   $("#tagInput").on("keyup",function(key){      
   	if(key.keyCode==13) {
   		let tagInput = $("input[id='tagInput']").val();
   		if(tagInput==""){
   			swal("태그를 입력해주세요");
   		}else{
       		let tagleng = $("span[class='tags']").length;
           	arrTag.push("#"+tagInput);
           	$("#tagArea").append("<span class='tags' data-value ="+tagInput+" data-idx="+tagleng+">"+"#"+tagInput+"<a id='deltag' onclick='DelTag(event)' style='color:#FA5858; padding: 5px;'>x</a></span>")
           	$("input[id='tagInput']").val('');	
           	console.log("배열="+arrTag);
   		}
   		
   	}
   });
  
   
   function DelTag(event){
   	let myTarget = $(event.target);
	let targetVal = myTarget.closest("span").data('value');
	let targetIdx = myTarget.closest("span").data('idx');
   	console.log(targetVal);
   	console.log(targetIdx);
   	$("span[data-idx="+targetIdx+"]").remove();
   	arrTag.splice(targetIdx,1);
   	console.log("삭제후배열="+arrTag);
   }
</script>

<!-- <script src="/resources/ckeditor/ckeditor.js"></script> -->
<script type="text/javascript">
$(function () {
	var inviteBtn = $("#inviteBtn");
	var inviteMail = document.getElementById('inviteMail');
	var inviteContent = document.getElementById('inviteContent');
	var invitePjName = document.getElementById('invitePjName');
	
	inviteBtn.on("click",function(){
		$.ajax({
			type : "post",
			url : "/coco/project/invite",
			data : {
				inviteMail : inviteMail.value,
				inviteContent : inviteContent.value,
				invitePjName : invitePjName.value
			},
			success : function(result){
				$('#inviteModal').modal('hide');
				$('#inviteMail').val('');
				$('#inviteContent').val('');
			}
		});
	});	
	
// 	CKEDITOR.replace('workContent', {
// 		footnotesPrefix: 'a',
// 		filebrowserUploadUrl : '${pageContext.request.contextPath}/imageUpload.do'
// 	});

    var start = $("#projectStart").val();
    var end =  $("#projectEnd").val();
    	console.log("start"+start);
    	console.log("end"+end);

    function cb(start, end) {
      $('#reportrange span').html(start + ' - ' + end);
    }

    $('#reportrange').daterangepicker({
      startDate: start,
      endDate: end,
      minDate: start,
      maxDate: end,
   	  locale: {
		format: 'YYYY-MM-DD'
	  }
	});
    cb(start, end);
  });
</script>     
</body>
</html>